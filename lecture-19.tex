% !TEX spellcheck = en_US
% !TEX spellcheck = LaTeX
\documentclass[a4paper,10pt,english]{article}
\input{header}
\title{Lecture 17: Reversed Processes}
\author{}
\begin{document}
\maketitle

\section{Reversed Processes}
\begin{defn} Let $X(t)$ be a stochastic process then $X(\tau-t)$ is the reversed process.
\end{defn}
\begin{lem} If $X(t)$ is a time homogeneous non-stationary Markov chain then the reversed process $X(\tau -t)$ is a non time-homogenous Markov chain.
\end{lem}
\begin{proof} Let $\F_m = \cup_{k \geq m}\{X_k = i_k\}$. Then, we can write
\begin{align*}
\Pr\{X_{m-1}=i|X_m=j,\F_{m+1}\} %&= \frac{\Pr\{X_{m-1}=i,X_m=j, \F_{m+1} \}}{\Pr\{X_m=j, \F_{m+1}\}}\\
&=\frac{\Pr\{X_{m-1}=i|X_m=j\}\Pr\{\F_{m+1} |X_{m-1}=i,X_m=j \}}{\Pr\{\F_{m+1} |X_m=j\}}.
\end{align*}
Result follows from Markov property of $X(t)$, i.e.
\begin{align*}
Pr\{\F_{m+1} |X_m= j, X_{m-1} = i \} &=\Pr\{\F_{m+1}=i|X_m=j\}.
\end{align*}
\end{proof}
%\begin{lem}  If $X(t)$ is a stationary Markov chain with transition matrix $P$ and equilibrium distribution $\alpha$, then the reversed chain $X(\tau -t)$ is a stationary Markov chain with same equilibrium distribution $\alpha$ and transition matrix $P^{\ast}$ such that
%\begin{align*}
%P^{\ast}_{ij} = \frac{\alpha_j}{\alpha_i}P_{ji}.
%\end{align*}
%\end{lem}
%\begin{proof} Easy to verify from definition of reversibility that 
%\begin{align*}
%\Pr\{X(t+1) = j, X(t) = i\} = \Pr\{X(t+1) = i, X(t) = j\}.
%\end{align*}
%Also, it's easy to check that $\alpha P^{\ast} = \alpha$.
%\end{proof}

\begin{lem} If $X(t)$ is a stationary Markov process with generator matrix $Q$ and equilibrium distribution $\pi$, then the reversed process $X(\tau -t)$ is a stationary Markov process with same equilibrium distribution $\pi$ and generator matrix $Q^{\ast}$ such that
\begin{align*}
Q^{\ast}_{ij} = \frac{\pi_j}{\pi_i}Q_{ji}.
\end{align*}
\end{lem}
\begin{proof} Easy to verify from definition of reversibility that 
\begin{align*}
\Pr\{X(t+h) = j, X(t) = i\} = \Pr\{X(t+h) = i, X(t) = j\}.
\end{align*}
Also, it's easy to check that $\pi Q^{\ast} = 0$.
\end{proof}

%%The sequence $\{X_n,X_{n-1} \hdots \}$ is called reverse process. Let $P^*$ denote the transition probability matrix. 
%%\begin{flalign*}
%%P_{ij}^*&=P(X_{n-1}=j|X_n=i)=\frac{P(X_{n-1}=j,X_n=i)}{P(X_n=i)}\\
%%&=\frac{P(X_{n-1}=j)P(X_n=i|X_{n-1}=j)}{P(X_{n}=i)}\\
%%&=\frac{P(X_{n-1}=j)}{P(X_{n}=i)}P_{ji}
%%\end{flalign*}
%%suppose we are considering a stationary Markov chain, $P(X_n=l)=P(X_{n-1}=l)=\alpha(l),~\forall l$, $\alpha(i){P^*}_{ij}=\alpha(j)(P)_{ji}$. 
%\begin{lem} A stationary Markov chain with transition matrix $P$ is reversible if the reversed process follows the same probabilistic law as the original process, i.e. $P^*= P$. Any non-negative vector $\alpha$ satisfying $\alpha_iP_{ij}=\alpha_jP_{ji},~\forall i,j \in I$ and $\sum_{j \in I}\alpha_j=1$ is stationary distribution of this Markov chain. 
%\end{lem}
\begin{lem} A stationary Markov process with generator matrix $Q$ is reversible if the reverses process follows the same probabilistic law as the original process, i.e. $Q^*= Q$. Any non-negative vector $\pi$ satisfying $\pi_iQ_{ij}=\pi_jQ_{ji},~\forall i,j \in I$ and $\sum_{j \in I}\pi_j=1$ is stationary distribution of this Markov process. 
\end{lem}
%\begin{proof} Let $\pi$ be a stationary distribution of  Since $Q^{\ast}_{ij} = \frac{\pi_j}{\pi_i}Q_{ji}$ and the condition for time reversibility is given by $\pi_i Q_{ij}=\pi_jQ_{ji}$. This is true because,
%
%It is clear that $\pi$ is an equilibrium distribution of forward Markov process, since
%\begin{align*}
%\sum_{i} \pi_i Q_{ij}=\sum_i \pi_j Q_{ji}=\pi_j \sum \alpha_i = 1.
%\end{align*}
%Since stationary probabilities are the unique solution of the above, the claim follows.
%\end{proof}
%\begin{proof} The condition for time reversibility is given by $\alpha_i P_{ij}=\alpha_jP_{ji}$. This is true because,
%\begin{align*}
%\sum_{i} \alpha_i P_{ij}=\sum_i \alpha_j P_{ji}=\alpha_j \sum \alpha_i = 1.
%\end{align*}
%Since stationary probabilities are the unique solution of the above, the claim follows.
%\end{proof}


%\subsection{Time Reversibility of Discrete Time Markov Chains}
%Consider a discrete time Markov chain with transition probability matrix $P$ and stationary probability vector $\alpha$.\\
%\textbf{Claim:} The reversed process is a Markov chain.
%\begin{proof}
%\begin{flalign*}
%&P(X_{m-1}=i|X_m=j,X_{m+1}=i_{m+1} \hdots )=\frac{P(X_{m-1}=i,X_m=j, \hdots )}{P(X_m=j, X_{m+1}=i_{m+1}\hdots )}\\
%&=\frac{P(X_{m-1}=i,X_m=j)P(X_{m+1}=i_{m+1}\hdots |X_{m-1}=i,X_m=j  )}{P(X_m=j)P(X_{m+1}=i_{m+1} \hdots |X_m=j)}\\
%&\stackrel{(a)}{=}\frac{P(X_{m-1}=i,X_m=j)P(X_{m+1}=i_{m+1}\hdots |X_m=j  )}{P(X_m=j)P(X_{m+1}=i_{m+1} \hdots |X_m=j)}\\
%&=P(X_{m-1}=i|X_m=j).\\
%\end{flalign*}
%where $(a)$ follows from the Markov property.
%\end{proof}
%The sequence $\{X_n,X_{n-1} \hdots \}$ is called reverse process. Let $P^*$ denote the transition probability matrix. 
%\begin{flalign*}
%P_{ij}^*&=P(X_{n-1}=j|X_n=i)=\frac{P(X_{n-1}=j,X_n=i)}{P(X_n=i)}\\
%&=\frac{P(X_{n-1}=j)P(X_n=i|X_{n-1}=j)}{P(X_{n}=i)}\\
%&=\frac{P(X_{n-1}=j)}{P(X_{n}=i)}P_{ji}
%\end{flalign*}
%suppose we are considering a stationary Markov chain, $P(X_n=l)=P(X_{n-1}=l)=\alpha(l),~\forall l$, $\alpha(i){P^*}_{ij}=\alpha(j)(P)_{ji}$. If $P^*=P^T$ then the Markov chain is called time reversible. Thus the condition for time reversibility is given by $\alpha P_{ij}=\alpha_jP_{ji}$. Any non-negative vector $X$ satisfying $X_iP_{ij}=X_jP_{ji},~\forall i,j$ and $\sum_{j \in \mathcal{N}_0}X_j=1$ is stationary distribution of time-reversible Markov chain. This is true because,
%\begin{flalign*}
%\sum_{i} X_i P_{ij}=\sum_i X_j P_{ji}=X_j \sum X_i = 1.
%\end{flalign*}
%Since stationary probabilities are the unique solution of the above, the claim follows.\\



\subsection{Example 4.7(E): Example 4.3(C) revisited}
Example 4.3(C) was with regard to the age of a renewal process. $X_n$ the forward process there was such that it increases in steps of 1 until it hits a value chosen by the inter arrival distribution. Hence the reverse process should be such that it decreases in steps of 1 until it hits 1 and then jumps to a state as chosen by the inter arrival distribution. Thus letting $\pi_i$ as the probability of inter arrival, it seems likely that  $P_{1i}*=\pi_i, ~ P_{i,i-1}=1,~ i > 1$. We have that $P_{i,1}=\frac{\pi_i}{\sum_{j \geq 1}\pi_j}=1-P_{i,i+1}, ~ i \geq 1$. For the reversed chain to be given as above, we would need 
\begin{flalign*}
&\alpha_i P_{ij}=\alpha_j P_{ji}^*\\
&\alpha_i \frac{\pi_i}{\sum_j \pi_j}=\alpha_1 \pi_i\\
&\alpha_i=\alpha_1 P(X \geq i)\\
&1=\sum_i \alpha_i=\alpha_1 E[X]; \alpha_i=\frac{P(X \geq i)}{E[X]}, 
\end{flalign*}
where $X$ is the inter arrival time. We need to verify that $\alpha_i P_{i,i+1}=\alpha_{i+1}P^*_{i+1,i}$ or equivalently $P(X \geq i)(1-\frac{\pi_i}{P(X \geq i)})=P(X \geq i)$ to complete the proof that the reversed process is the excess process and the limiting distributions are as given above. But that is immediate.


%\subsection{Time Reversibility for CTMC}
%\begin{prop}
%Markov property holds going backward in time. i.e.
%\begin{equation*}
%Pr(X(t-s)=j|X(t)=i,X(y), y > t)=Pr(X(t-s)=j|X(t)=i).
%\end{equation*}
%\begin{proof}
%\begin{flalign*}
%&Pr(X(t-s)=j|X(t)=i, X(y), y>t)=\frac{Pr(X(t-s)=j, X(t)=i, X(y), y>t)}{Pr(X(t)=i, X(y), y>t)}\\
%&\stackrel{(a)}{=}\frac{Pr(X(t-s)=j)Pr(X(t)=i|X(t-s)=j)Pr(X(y), y>t|X(t)=i)}{Pr(X(t)=i, X(y), y>t)}\\
%&\stackrel{}{=}\frac{Pr(X(t-s)=j)Pr(X(t)=i|X(t-s)=j)}{Pr(X(t)=i)}\\
%&\stackrel{}{=}Pr(X(t-s)=j|X(t)=i).\\
%\end{flalign*}
%where $(a)$ follows from the Markov property of forward chain.  
%\end{proof}
%\end{prop}
%Now we would like to characterize the sojourn time in each state. Since the amount of time spent in each state is same whether in forward or backward direction, one expects the sojourn time for the reverse chain to be exponential with the same parameter $\nu_i$. We can verify this formally:
%\begin{flalign*}
%&Pr(\text{Process in state i during [t-s,t]}|X(t)=i)\\
%&= {Pr(\text{Process in state i during [t-s,t]})}/{Pr(X(t)=i)}\\
%&= \frac{Pr(X(t-s)=i)e^{-\nu_i s}}{Pr(X(t)=i)}=e^{-\nu_i s}.\\
%\end{flalign*}
%Next, we would like to characterize the transition probabilities of the reversed chain. The sequence of states visited by the reverse process constitutes a discrete-time Markov chain with transition probabilities $P_{ij}^*$ give by 
%\begin{equation}
%P_{ij}^*= \frac{\pi_jP_{ji}}{\pi_i},
%\end{equation} 
%where $\{\pi_i,~ i \geq 0\}$ are the stationary probabilities of the embeddede discrete time Markov chain with transition probabilities $P_{ij}$. Denote 
%\begin{equation}
%q_{ij}^*=\nu_iP_{ij}^*
%\end{equation}
%as the infinitesimal rates of the reversed process. Using the previous formula for $P_{ij}^*$ we see that
%\begin{equation}
%q_{ij}^*=\frac{\nu_i\pi_jP_{ji}}{\pi_i}.
%\end{equation} 
%Recall that 
%\begin{equation}
%P_{k}=\frac{\pi_k / \nu_k}{\sum_{i}\pi_i / \nu_i},
%\end{equation}
%we see that 
%\begin{equation}
%\frac{\pi_i}{\pi_j}=\frac{\nu_j P_j}{\nu_i P_i}.
%\end{equation}
%Hence, 
%\begin{equation}
%q_{ij}^*=\frac{\nu_j P_{j}P_{ji}}{P_i}= \frac{P_jq_{ji}}{P_i}.
%\end{equation}
%That is,
%\begin{equation*}
%P_{i}q_{ij}^*=P_{j}q_{ji}.
%\end{equation*}
%Form the above equation, it is obvious that 
%\begin{equation*}
%\sum_{i}P_i q_{ij}^*=0.
%\end{equation*} 
%This implies that $P_j,~j \geq 0$ are the stationary probabilities for the reverse chain as $P_j$s satisfy the balance equations.
%\begin{defn}
%A stationary CTMC is said to be time reversible if the reverse process follows the same probabilistic law as the original process. That is, if, for all $i,j$
%\begin{equation*}
%q_{ij}^*= q_{ij} \iff P_{i}q_{ij}=P_jq_{ji}.
%\end{equation*} 
%\end{defn} 


\subsection{Simple Queues}
\begin{cor} Number of customers in a simple M/M/1 queue at equilibrium is a reversible Markov process.
\end{cor}

\begin{thm}[PASTA] Poisson arrivals see time averages.
\end{thm}
\begin{thm}[Little's law] Consider a stable single server queue. Let $T_i$ be waiting time of customer $i$, $N(t)$ be the number of customers in the system at time $t$, and $A(t)$ be the number of customers that entered system in duration $[0,t)$, then
\begin{align*}
\lim_{t \to \infty}\frac{\int_{0}^tN(u)du}{t} &= \lim_{t \to \infty} \frac{\sum_{i=1}^{A(t)}T_i}{A(t)}.
\end{align*} 
\end{thm}
\begin{proof}
Let $A(t), D(t)$ respectively denote the number of arrivals and departures in time $[0,t)$. Then, we have 
\begin{align*}
\sum_{i=1}^{D(t)}T_i \leq \int_{0}^tN(u)du \leq \sum_{i=1}^{A(t)}T_i.
\end{align*}
Further, for a stable queue we have
\begin{align*}
\lim_{t \to \infty}\frac{D(t)}{t} = \lim_{t \to \infty}\frac{A(t)}{t}.
\end{align*}
Combining these two results, the theorem follows.
\end{proof}

\subsection{Truncated Reversible Processes}

%\begin{cor}
%Consider an M/M/s queue with Poisson$(\lambda)$ arrivals and each server having exponential service time $\exp(\mu)$ service. If $\lambda > s \mu$, then the output process in steady state is Poisson$(\lambda)$.
%\end{cor}
%\begin{proof}
%Let $X(t)$ denote the number of customers in the system at time $t$. Since M/M/s process is a birth and death process, it follows from the previous proposition that $\{X(t),~t \geq 0\}$ is time reversible. Now going forward in time, the time instants at which $X(t)$ increases by 1 are the arrival instants of a Poisson process. Hence, by time reversibility, the time Points at which $X(t)$ increases by 1 when we go backwards in time also constitutes a Poisson process. But these instants are exactly the departure instants of the forward process. Hence the result.
%\end{proof}
\begin{prop}
A time-reversible chain with limiting probabilities $\pi_j,~ j \in I$, that is truncated to the set $A\subseteq I$ and remains irreducible is also time reversible and has limiting probabilities 
\begin{align*}
\pi_j^A&=\frac{\pi_j}{\sum_{i \in A}\pi_i},~ j \in A.
\end{align*}
\end{prop}
\begin{proof}
We must show that 
\begin{align*}
\pi_i^AQ_{ij}&=\pi_j^AQ_{ji},~ i \in A,~ j \in A,
\end{align*}
or equivalently,
\begin{align*} 
\pi_iQ_{ij}&=\pi_jQ_{ji},~ i \in A,~ j \in A.
\end{align*}
But this is true as the original chain is time reversible.
\end{proof}
\begin{exmp}[Two queues with joint waiting room] Consider two independent M/M/1 queues with arrival and service rates $\lambda_i$ and $\mu_i$ respectively for $i \in [2]$. Then, joint distribution of two queues is
\begin{align*}
\pi(n_1,n_2) &= (1 -\rho_1)\rho_1^{n_1}(1-\rho_2)\rho_2^{n_2},~~n_1,n_2 \in \N_0. 
\end{align*}
Suppose both the queues are sharing a common waiting room, where if arriving customer finds $R$ waiting customer then it leaves. In this case,
\begin{align*}
\pi(n_1,n_2) &= (1 -\rho_1)\rho_1^{n_1}(1-\rho_2)\rho_2^{n_2},~~(n_1,n_2) \in A \subseteq \N_0\times\N_0. 
\end{align*}
\end{exmp}


\end{document}
