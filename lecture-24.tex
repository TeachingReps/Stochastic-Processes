\documentclass[a4paper,english,10pt]{article}
\input{header}

%opening
\title{Lecture 23: Polya's Urn Scheme}
\author{}

\begin{document}
\maketitle
\section{Optional Sampling theorem}
The gambling interpretation of the stochastic integral suggests that it is natural to let the amount bet at time $n$ depend on the outcomes of the first $n-1$ flips but not on the flip we are betting on, or on later flips. The next result shows that we cannot make money by gamblingon a fair game.

\begin{thm}Let $X_n$ be a martingale. If $H_n$ is predictable and each $H_n$ is bounded, then $(H\cdot X)_n$ is a martingale.
\end{thm}
\begin{proof} It is easy to check that $(H\cdot X)_n \in \F_n$. Thhe boundedness of the $H_n$ implies $E|(H\cdot X)_n|<\infty$ for each $n$. With this established, we can compute conditional expectations to conclude
\eq{
E((H\cdot X)_{n+1}| \F_n)&=(H\cdot X)_n+E(H_{n+1}(X_{n+1}-X_n)| \F_n)\\
       &=(HX)_n+H_{n+1}E(X_{n+1}-X_n| \F_n)\\
       &=(H\cdot X)_n.\qedhere
}
since $H_{n+1}\in \F_n$ and $E(X_{n+1}-X_n| \F_n)=0$
\end{proof}
The last theorem can be interpreted as: you can't make money by gambling on a fair game. This conclusion does not hold if we only assume that $H_n$ is optional, that is $H_n\in \F_n$, since then we can base our bet on the outcome of the coin we are betting on.

\begin{thm} 
Suppose $M_0,M_1,\dots $ is a martingale with respect to$\{\F_n\}$ and suppose $T$ is a stopping time. Suppose that $T$ is bounded, $T\leq K$. Then
\eq{
\E[M_T|\F_0]=M_0.
}
In particular, $\E M_T=\E M_0$.
\end{thm}
To prove this fact, we first note that the event $\{T>n\}$ is measurable with respect to $\F_n$ (since we need only the information up through time $n$ to determine if we have stopped by time $n$). 
Since $M_T$ is the random variable which equals $M_j$ if $T=j$ we can write
\eq{
M_T = \sum_{j=0}^K M_j I\{T=j\}.
}
Let us take the conditional expectation with respect to $\F_{K-1}$,
\eq{
\E(M_T|\F_{K-1})=\E(M_KI\{T=K\}|\F_{K-1})+\sum_{j=0}^{K-1} \E(M_jI\{T=j\}|\F_{K-1}).
}
For $j\leq K-1, M_jI\{T=j\}$ is $\F_{K-1}$- measurable; hence
\eq{
\E(M_jI\{T=j\}|\F_{K-1})=M_jI\{T=j\}.
}
Since $T$ is known to be no more than $K$, the event $\{T=K\}$ is the same as the event $\{T>K-1\}$. The latter event is measurable with respect to $\F_{K-1}$. Hence using equality
\eq{
\E(YZ|\F_n)= Z\E(Y|\F_n).
}
Where $Y$ is any random variable and $Z$ is a random variable that is measurable with respect to finite number of random variables $X_1,X_2,\dots,X_n$.

\eq{
\E(M_KI\{T=K\}|\F_{K-1}) &=\E(M_KI\{T>K-1\}|\F_{K-1})\\
								   &=I\{T>K-1\}\E(M_K|\F_{K-1})\\
								   &=I\{T>K-1\}M_{K-1}.
}

The last equality follows from the fact the $M_n$ is a martingale. Therefore,
\eq{
\E(M_T|\F_{K-1}) &=I\{T>K-1\}M_{K-1}+\sum_{j=0}^{K-1}M_jI\{T=j\}\\
								   &=I\{T>K-2\}M_{K-1}+\sum_{j=0}^{K-2}M_jI\{T=j\}.
}
If we work through this argument again, this time conditioning with respect to $\F_{K-2}$, we gat
\eq{
\E(M_T|\F_{K-2}) &=\E(\E(M_T|\F_{K-1})|\F_{K-2})\\
								   &=I\{T>K-3\}M_{K-2}+\sum_{j=0}^{K-3}M_jI\{T=j\}.
}
We can continue this process untill we get
\eq{
\E(M_T|\F_0)=M_0.
}

There are many examples of interest where the stopping time $T$ is not bounded. Suppose $T$ is a stopping time with $\mathbb{P}\{T<\infty\}=1$, i.e., a rule that guarantees that one stops eventually. (Note that the time associated to the martingale betting strategy satisfies this condition.) When can we conclude that $\E(M_T)=\E(M_0)?$ To investigate this consider the stopping times $T_n=min\{T,n\}$. Note that
\eq{
M_T=M_{T_{n}}+M_TI\{T>n\}-M_nI\{T>n\}.
}
Hence,
\eq{
\E(M_T)=\E(M_{T_{n}})+\E(M_TI\{T>n\})-\E(M_nI\{T>n\}).
}

Since $T_n$ is a bounded stopping time, it follows from the above that $\E(M_{T_{n}})=\E(M_0)$. We would like to be able to say that the other termsdo not contribute as $n\rightarrow \infty$. The second term is not much of a problem.  Since the probability of the event $\{T>n\}$ goes to 0 as $n\rightarrow \infty$, we are taking the expectation of the random variable $M_T$ restricted to a smaller and smaller set. One can show that if $\E(|M_T|)<\infty$ then $\E(|M_T|I\{T>n\}) \rightarrow 0$.

The third term, if $M_n$ and $T$ are given satisfying
\eq{
\lim_{n\in \N}\E(|M_n|I\{T>n\})=0,
}
then we will be able to conclude that $\E M_T =\E M_0$. 
We summarize this as follows.
\begin{thm}[Optional sampling theorem] 
Suppose $M_0,M_1,\dots$ is a martingale with respect to $\{\F_n\}$ and $T$ is a stopping time satifsying $\mathbb{P}\{T<\infty\}=1$,
\eq{
\E(|M_T|)<\infty,
}
and
\eq{
\lim_{n\rightarrow \infty}\E(|M_n|I\{T>n\})=0.
}
Then, $\E M_T =\E M_0$.
\end{thm}

\section{Polya's Urn Scheme}
The number of black balls in the first $n$ draws would then have a $Bin(n,\frac{b_0}{b_0+w_0})$.


Consider a discrete time stochastic process $\{(B_n,W_n): n \in \N\}$, where $B_n, W_n$ denote the number of black and white balls in an urn after $n \in \N$ draws. 
At each draw $n$, balls are uniformly sampled from this urn. 
After each draw, one additional ball of the same color to the drawn ball, is returned to the urn. 
We are interested in characterizing evolution of this urn, given initial urn content $(b_0,w_0)$.  
For example, if the first drawn ball is a black, then $(B_1,W_1) = (b_0+1, w_0)$. 

It is clear that $B_n+W_n = b_0+w_0+n$. 
Further, for any $n$ draws $\xi \in \{b,w\}^n$, we can find the indices of black draws
\eq{
I &= \{i \in [n]: \xi_i = b\}.
}
With this, we can write the probability 
\eq{
\Pr\{\xi\} &= \frac{\prod_{i = 1}^{|I|}(b_0+i-1)\prod_{j= 1}^{n-|I|}(w_0+i-1)}{\prod_{i=1}^{n}(b_0+w_0+i-1)}
}
We note that $\xi_i$ represent the color of the $i$th drawn ball, then we know that Polya's Urn scheme generates exchangeable random sequence $\xi = \{\xi_i : i \in \N\}$.
Let $\sE_n = \sigma(\xi_1, \dots, \xi_n)$ be the $\sigma$-field generated by finite $n$ permutation, and $\sE = \cap_{n \in \N}\sE_n$ be the exchangeable $\sigma$-field.
We represent the proportion of black balls after $n$ draws by 
\eq{
X_n=\frac{B_n}{B_n+W_n}=\frac{B_n}{b_0+w_0+n}. %, 0\leq X_n \leq1.
}
Given the past realizations $\xi_1,\xi_2,\dots,\xi_n$, we can write 
\eq{
B_{n+1} &= B_n1\{\xi_n = w\} + (B_{n}+1)1\{\xi_n = b\} = B_n + 1\{\xi_n = b\}.
}
Therefore, we can write 
\eq{
\E[X_{n+1}|\xi_1,\xi_2,\dots,\xi_n]&=\frac{1}{b_0+w_0+n+1}\E[B_{n+1}|\xi_1,\xi_2,\dots,\xi_n] =\frac{B_n+X_n}{b_0+w_0+n+1} =X_n.
}
That means it is a martingale.


%Let $B_n$ be the number of black balls in urn after $n$ draws and $B_0 = b_0$. Now probability of getting a black ball in first draw is
% \eq{
%\mathbb{P}(B_1=b_0+1)= \frac{b_0}{b_0+w_0},
%}
%and probability of a getting white ball in first draw is
% \eq{
%\mathbb{P}(B_1=b_0)= \frac{w_0}{b_0+w_0}.
%}
%Similarly after two draws,
% \eq{
%\mathbb{P}(B_2=b_0) &= \frac{w_0}{b_0+w_0} \cdot \frac{w_0+1}{b_0+w_0+1}\\
%\mathbb{P}(B_2=b_0+1)&= \frac{b_0}{b_0+w_0} \cdot \frac{w_0}{b_0+w_0+1}+\frac{w_0}{b_0+w_0} \cdot \frac{b_0}{b_0+w_0+1}\\
%\mathbb{P}(B_2=b_0) &= \frac{b_0}{b_0+w_0} \cdot \frac{b_0+1}{b_0+w_0+1}.
%}
%For first three draws,
% \eq{
%\mathbb{P}(bwb)= \frac{b_0}{b_0+w_0} \cdot \frac{w_0}{b_0+w_0+1} \cdot \frac{b_0+1}{b_0+w_0+2}\\
%\mathbb{P}(bbw)= \frac{b_0}{b_0+w_0} \cdot \frac{b_0+1}{b_0+w_0+1} \cdot \frac{w_0}{b_0+w_0+2}\\
%\mathbb{P}(wbb)= \frac{w_0}{b_0+w_0} \cdot \frac{b_0}{b_0+w_0+1} \cdot \frac{b_0+1}{b_0+w_0+2},
%}
%where $b$ stands for black ball and $w$ stands for white ball. We observe above 3 equations, all of them are same. like wise
% \eq{
%\mathbb{P}(bbwww)= \frac{b_0(b_0+1)w_0(w_0+1)(w_0+2)}{\prod_{i=0}^4 (b_0+w_0+i)}\\
%\mathbb{P}(bwwwb)= \frac{b_0w_0(w_0+1)(w_0+2)(b_0+1)}{\prod_{i=0}^4 (b_0+w_0+i)}.
%}
%Again above two probabilities are equal.
\begin{defn}
An infinite sequence $\{X_i\}_{i=1}^{\infty}$ of random variables is exchangeable if $\forall$ $n=1,2,\dots$
 \eq{
X_1,\dots,X_n=X_{\pi(1)},\dots ,X_{\pi(n)}, \forall \pi \in S(n),
}
where $S(n)$ is the symmetric group, the group of permutations.
\end{defn}
Polya's Urn Model is one of the examples for exchangeability. An Example would be following
 \eq{
\mathbb{P}(bbwww)=\mathbb{P}(bwwwb)
}
If $\xi_1,\xi_2,\dots,\xi_n$ denote the sigma algebra for the color of the drawn ball i.e., $\xi_i$ represents the color of the $i^{th}$ ball, from the definition of excangeability
\eq{
(\xi_1,\xi_2,\xi_3,\xi_4,\xi_5)=(\xi_2,\xi_1,\xi_5,\xi_4,\xi_3).
}
\begin{note}
Polya's Urn scheme generate exchangeable sequences.
\end{note}
Let 
\eq{
X_n=\frac{B_n}{B_n+W_n}=\frac{B_n}{b_0+w_0+n},\ 0\leq X_n \leq1,
}
represents the proportion of black balls after $n$ draws, then given the past $\xi_1,\xi_2,\dots,\xi_n$
\eq{
B_{n+1} =
\left\{
	\begin{array}{ll}
		B_n  & w.p \ (1-\frac{B_n}{b_0+w_0+n}) \\
		B_{n+1} & if \ \xi_{n+1} \ w.p \ \frac{B_n}{b_0+w_0+n}.
	\end{array}
\right.
}
Now
\eq{
\E[X_{n+1}|\xi_1,\xi_2,\dots\xi_n]&=\frac{1}{b_0+w_0+n+1}\E[B_{n+1}|\xi_1,\xi_2,\dots\xi_n]\\
								&=\frac{1}{b_0+w_0+n+1}\E[B_n(1-X_n)+(B_n+1)X_n]\\
								&=\frac{B_n+X_n}{b_0+w_0+n+1}\\
								&=X_n.
}
That means it is a martingale.
\begin{note}
$X_n$ is a martingale.
\end{note}
\subsection{Analysis of the Polya urn model}
\begin{thm}(De Finetti 1931)
A binary sequence $\{X_n\}_{i=1}^{\infty}$ is exchageable iff there exixtes a distribution function $F(p)$ on $[0,1]$ such that for any $n\geq1$,
\eq{
\mathbb{P}(X_1=x_1,\dots,X_n=x_n)=\int_0^1 p^{S_n}(1-p)^{n-S_n}dF(p)
}
where $S_n=\sum_i x_i$.
\end{thm}
The distribution $F$ is a function of the limiting frequency
\begin{xalignat*}{3}
&Y =\bar{X}_{\infty} =\lim_{n \in \N}\frac{\sum_i X_i}{n}, &&\Pr\{Y\leq p\} =F(p),
\end{xalignat*}
and conditioning on $Y=p$ results in iid Bernoulli draws
\eq{
\mathbb{P}(X_1=x_1,\dots,X_N=x_n|Y=p)= p^{S_n}(1-p)^{n-S_n},
}
and for the Polya urn model
\eq{
\lim_{n\to \infty} \bar{X}_n=Y~Beta\left(\frac{B_0}{B_0+W_0},\frac{W_0}{B_0+W_0} \right)
}
The result can be interpreted from a statistical, probabilistic and function analytic perspective.

We will use De Finetti's theorem to compute the limiting distribution for the Polya urn model 
\eq{
\lim_{n\to \infty} \bar{X}_n=Y~Beta\left(\frac{B_0}{B_0+W_0},\frac{W_0}{B_0+W_0} \right).
}
We first define the Beta and Gamma functions
\begin{xalignat*}{5}
&\beta(x,y)=\int_0^1 p^{x-1}(1-p)^{y-1}dp, &&\Gamma(x+1)=x\Gamma(x), &&\beta(a,b)=\frac{\Gamma(a)\Gamma(b)}{\Gamma(a+b)}.
\end{xalignat*}
The probability of observing $k$ black balls given $n$ draws
\begin{align}
\mathbb{P}(k \text{ black balls given } n \text{ draws})&=\dbinom{n}{k}\frac{B_0(B_0+1)\dots(B_0+k-1)W_0(W_0+1)\dots(W_0+n-k-1)}{(B_0+W_0)(B_0+W_0+1)\dots(B_0+W_0+n-1)}\\
								&=\dbinom{n}{k}\frac{\beta(B_0+k,B_0+n-k)}{\beta(B_0,W_0)}.
\end{align}
Note that the proportion of black balls at any stage $n$ of the process is
\begin{xalignat*}{3}
&\rho_n=\frac{B_n}{B_n+W_n}, &&\rho_{\infty}=\lim_{n\to \infty}\frac{B_n}{B_n+W_n}.
\end{xalignat*}
We know that 
\eq{
\mathbb{P}(k \text{ black balls given } n \text{ draws}|\rho_{\infty}=p)=\dbinom{n}{k}p^k(1-p)^{n-k},
}
and if $\rho_{\infty}~F(p)$ then,
\eq{
\mathbb{P}(k \text{ black balls given } n \text{ draws})=\int_0^1\mathbb{P}(k \text{ black balls given } n \text{ draws}|\rho_{\infty}=p)dF(p),
}
\begin{equation}
\mathbb{P}(k \text{ black balls given } n \text{ draws})=\dbinom{n}{k} \int_0^1p^k(1-p)^{n-k}dF(p).
\end{equation}
By equating (2) and (3) we obtain,
\eq{
\int_0^1 p^k(1-p)^{n-k}dF(p) &= \frac{\beta(B_0+k,B_0+n-k)}{\beta(B_0,W_0)}\\
					   &=\frac{1}{\beta(B_0,W_0)}\int_0^1p^{B_0+k-1}(1-p)^{B_0+n-k-1}dp\\
					   &=\int_0^1 p^k (1-p)^{n-k}\frac{p^{B_0-1}(1-p)^{W_0-1}}{\beta(B_0,W_0)}dp,
}
which gives the limiting distribution for Polya's urn scheme as
\eq{
f(p)=\frac{1}{\beta(B_0,W_0)}p^{B_0-1}(1-p)^{W_0-1}.
}

\end{document}