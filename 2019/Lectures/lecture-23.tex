% !TEX spellcheck = en_US
% !TEX spellcheck = LaTeX
%\documentclass[a4paper,10pt,english]{article}
\documentclass[all-lectures.tex]{subfiles}
%\input{header}
%\title{Lecture 01: Poisson Processes}
%\author{}
\setcounter{chapter}{6}

\begin{document}
%\maketitle

%\chapter{Renewal Theory}
\setcounter{section}{2}
\setcounter{subsection}{1}
\chapter{Queuing Theory}
\section*{\centering{Lecture 23 \linebreak }}
\chr
\section{GI/GI/1 Queue}
Consider $GI/GI/1$ queue. Let $\{A_n\}$ be i.i.d interarrival times and $\{s_n\}$ be i.i.d. service times. Let $\mu = \E[s_1] - \E[A_1]$. Let the waiting time of $n^{th}$ arrival be $W_n$. The process $\{W_n\}$ is a regenerative process in which the arrivals seeing the queue empty are the regeneration epochs. Let $\tau$ be the regeneration length. If $\mu<0$, we have seen that  $W_n$ converges to a stationary distribution and hence $\E[\tau]<\infty$. Also, $\P\{\tau = 1\} = \P\{s_0 < A_1\} >0$. Therefore, $\tau$ is aperiodic. If $\mu\geq 0$, $W_n \to \infty$ as $n \to \infty$ and $\E[\tau] = \infty$.  If $\mu =0$, then $\E[\tau]= \infty$ but $\P\{\tau < \infty\} =1$.\\
\indent Let $V_t=$ total work (service times) of the customers in the queue, including the residual service time of the custmoer in service. The customers seeing the empty queue are regeneration epochs. Let $\overline{\tau}$ be the regeneration length. We have $\E[\overline{\tau}] = \E[\tau]\E[A_1]$. If $\mu < 0$, then also, $\P\{\tau =1\}>0$. Thus, If $A_1$ is non-lattice, $\overline{\tau}$ is also non-lattice. Thus, $V_t \to V_\infty$ in distribution as $t \to \infty$ if $\mu <0$.\\
\indent Furthermore, %{\color{red} Picture to be included.}
\begin{align*}
\E[V_\infty] &= \frac{\E[\int_0^{\overline{\tau}} V_t dt]}{\E[\overline{\tau}]} \\
&= \frac{1}{2} \frac{\E[s_1^2] + \E[W_1]\E[s_1]}{\E[A_1]}.
\end{align*}
The last line follows from Figure \ref{fig:work_in_queue}. The quantity $\int_0^{\overline{\tau}} V_t dt$ is the area under the curve which can be split into several traingles and parellelogram as shown. \\
\begin{figure}
\centering
\includegraphics[scale=0.4]{Figures/Work_In_Queue.jpg}
\caption{Work in queue: V(t)}
\label{fig:work_in_queue}
\end{figure}
\indent Let the time between consecutive regeneration epochs of $\{V_t\}$ be called a \textit{cycle}. During this time, the duration when the queue is empty is called an \textit{idle }period and the rest is called \textit{busy} period. Then, $\E[\text{busy period}] = \E[\sum_{k=0}^{\tau -1} s_k]$ if $t=0$ is a regeneration epoch. Hence, 
\begin{align*}
\P\{V_\infty = 0\}  &= \frac{ \E[\int_0^{\overline{\tau}} 1\{V_t=0\}dt]}{\E[\overline{\tau}]} \\
&= \frac{\E[\overline{\tau}]-\E[Busy Period]}{\E[\overline{\tau}]} \\
&= \frac{\E[{\tau}]\E[A_1]-\E[\tau]\E[s_1]}{\E[{\tau}]\E[A_1]} \\
&= 1-\frac{\E[s_1]}{\E[A_1]}.
\end{align*}

\begin{figure}
\centering
\includegraphics[scale=0.4]{Figures/queue_length_evolution.jpg}
\caption{Evolution of queue length}
\label{fig_queue_length_evolution}
\end{figure}
Let $q_t$ be the queue length at time $t$. If $\mu = \E[X_1] = \E[s_1] - \E[A_1] < 0$, $q_t \to q_\infty$ in distribution as $t \to \infty$. Let $S_k$ be the sojourn time of the $k^{th}$ customer and $0$ be a regeneration epoch. Then, $W_k$ and the sojourn time $S_k = W_k + s_k$ also have stationary ditributions and have the same regeneration epochs. Also, the regeneration epochs of $V_t$ and $q_t$ are the same with length $\overline{\tau}$. Then, (assuming $\E_\pi[q_\infty]$ and $\E_\pi[s_1]$ are finite, this requires $\E[s_1^2] < \infty$)
\begin{align*}
\E_{\pi}[q_\infty] &= \frac{\E\left[ \int_0^{\overline{\tau}} q_t dt\right]}{\E[\overline{\tau}]} \\
&= \frac{\E\left[ \sum_{k=0}^{\tau-1} S_k \right]}{\E[\tau]\E[A_1]} \\
&= \frac{ \E_{\pi}[S_1] }{\E[A_1]} \\
&= \lambda \E_{\pi}[S_1].
\end{align*}
where $\lambda$ is the arrival rate and $\E_{\pi}[ S_1]$ is the mean sojourn time under stationarity. Figure \ref{fig_queue_length_evolution} shows the evolution of queue length in one regeneration cycle. $\int_0^{\overline{\tau}} q_t dt$ is the area under the curve for $q(t)$. This is equal to  $\sum_{k=0}^{\tau-1} S_k $ as the break of the area in the Figure \ref{fig_queue_length_evolution} shows.\\
\indent The above is an example of a general result called \textit{Little's law}. 
$\E_{\pi}[Number\ in\ the\ system] = (Arrival\ rate) * \E_{\pi}[Sojourn \ time]$. This holds for a general queuing system with the same proof if $\int_0^\tau q_t dt = \sum_{k=0}^{\tau -1} S_k$ is valid in that system. We will see many examples of this in next few lectures.\\

\indent \textbf{$GI/GI/1$-Last Come First Serve (LCFS):} When a new custmorer arrives, the service of the current customer is stopped and servicing of the latest customer begins. After completion of a service, the server resumes service of the customer it was serving before to complete the remaining service. \\
\indent An example of this type of queueing is a stack in a computer system.

\textbf{Priority queues:} There are different classes of customers and each class is assigned a priority. The custmoer with the highest priority in the queue is served before others. 

All  the above schemes have an important property - work conservation:
\begin{enumerate}
\item The server is never idle when there is work in the system.
\item Workload will never be increased by policies and queuing schemes. 
\end{enumerate}
\indent Irrespective of the policy the queue becomes empty and gets an arrival to the empty queue, at the same time in all the work-conserving queues. Thus, the  regeneration epochs for $W_n$, $q_t$ or $V_t$ in the different queues remain same. Hence, $\E[\tau]< \infty$, $\E[\overline{\tau}] < \infty$ and has stationary distributions for all these processes for any of the work conserving policy if $\E[X_1] < 0$. But, the stationary distribution of $w$, $q$ etc. may be different for different queues. All these queuing systems satisfy Little's law.\\
%Let $\overline{\tau}_{LCFS}$ and $\overline{\tau}_{FCFS}$  be the regeneration length of workload process of LCFS and FCFS policies respectively. Then, $\overline{\tau}_{LCFS} = \overline{\tau}_{FCFS}$ a.s. Let $W_n^{LCFS}$ and $W_n^{FCFS}$ be the waiting time of LCFS and FCFS policies respectively. The regeneration lenght of $\{W_n^{LCFS}\}$ and $\{W_n^{FCFS}\}$ are equal a.s. But, $\E[W_n^{LCFS}]$ and $\E[W_n^{FCFS}]$ are not equal in general. 

%\subsection{Palm Theory goes to the next lecture}
%Consider a $GI/GI/1$ queue. Let $T_n$ be the $n^{th}$ regeneration epochs of $\{V_t\}$. Then $W_n = V_{T_n}$ a.s. But, $W_\infty \stackrel{d}{\neq} V_\infty$ in general. Also, in renewal process, we have seen inspection paradox where $X_{N(t)} \stackrel{d}{\neq} X_n$. This shows that distriubion of the process sampled at some points may be different from the distribution of the process.\\
%\indent Let  $\{X_t, -\infty<t<\infty\}$ be a stochastic process and $\tau = {\dots,\tau_{-1},\tau_{0}},\tau_{1},\dots$ be a point process. Let $N(t)$ be number of point of $\tau$ in the interval $(0,t]$. Let $Z = (X_t,\tau)$ and $\theta_t$ be the shift operator defined as $\theta_s Z = (\theta_t X,\theta \tau)$ where $(\theta_t X)_s = X_{t+s}$ and $(\theta_t \tau)_n = t+\tau_n$. $Z$ is a stationary process
\noindent \textbf{Restriction of Markov chain to a subset of states:} \\
\indent Consider $M/M/1/N$ queue with finite buffer of length $N$. The queue length process $\{q_t\}$ is a finite state space, irreducible Markov chain. It is always positive recurrent with stationary distribution $\pi_N$. The stationary distribution satisfies $\pi_N Q = 0$ where $Q$ is the rate matrix given by $Q(i,i+1) = \lambda$ for $ 0 \leq i < N$, $Q(i,i-1) = \mu$ for $0 < i \leq N$ and $Q(0,1) = \lambda$. Its stationary distribution can also be obtained from that of $M/M/1$ queue as 
\begin{align*}
\pi_{N}(n) = \begin{cases}
	\frac{\pi_{}(n)}{\sum_{k=0}^{N} \pi_{}(k)} & \text{ for } n \in \{1,2,\dots,N\}. \\
	0 & \text{ otherwise}
	\end{cases}
\end{align*}
using the following argument. \\
\indent In general, if $S$ is the state space of a Markov chain $\{X_t\}$ with rate matrix $Q$ and stationary distribution $\pi$, we can limit the Markov chain to a subset $A \subset S$ (by modifying the $Q$ matrix such that the chain is not allowed to exit $A$ as in the $M/M/1/N$ queue above) and obtain the corresponding stationary distribution as 
\begin{align*}
\pi_A(i) = \begin{cases} 
			\frac{\pi(i)}{\sum_{j \in A} \pi(j)} & \text{ if } i \in A, \\
			0 & \text{ if } i \notin A. \\
			\end{cases}
\end{align*}
\end{document}

