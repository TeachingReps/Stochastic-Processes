% !TEX spellcheck = en_US
% !TEX spellcheck = LaTeX
%\documentclass[a4paper,10pt,english]{article}
\documentclass[all-lectures.tex]{subfiles}
%\input{header}
%\title{Lecture 01: Poisson Processes}
%\author{}
\setcounter{chapter}{4}
\usepackage{enumitem}
\begin{document}
%\maketitle

%\chapter{Martingales}
\setcounter{section}{4}
\setcounter{subsection}{1}

\section*{\centering{Lecture 28 \linebreak }}
\section{M/M/1 queue with multiple class of customers:}
Let $C$ denotes the set of classes, $\lambda_c$ be Poisson arrival rate for class-$c$, $\mu_c$ be rate of service of class-$c$. The traffic intensity of class-$c$ be $\rho_c = \frac{\lambda_c}{\mu_c}$.

If $\rho < 1$ then $p_{\pi} (q=n) = (1-\rho) \rho^n$. $q_t$ be the number of customers in the queue. $\frac{\lambda_c}{\lambda}$ be the probability of class-$c$. The mean service time is given by $\sum_c \frac{\lambda_c}{\lambda} \frac{1}{\mu_c}$. Probability that a customer is of class-$c$ is $\frac{\lambda_c}{\lambda}$.
\eq{
P[X_t = (c_1, c_2, \dots, c_n)] = (1-\rho) \rho^n \prod_{i=1}^{n} \frac{\lambda_{c_i}}{\lambda}
}
$\{X_t\}$ Markov chain, stationary, S is countable.

The future arrival process, $X_t$, past departure process are independent.
A system with above properties is called quasi reversible.
The reversed process $\tilde{X}_t$ is also quasi reversible if $\{X_t\}$ is.

Let $N_+^c (t)$ be arrival process of class-$c$ and $N_-^c (t)$ be departure process of class-$c$.
The arrival process for different classes are independent of each other.
\begin{prop}
The ariival process of different classes are independent Poisson process and the departure  process of different classes are also independent Poisson process.
\end{prop}
\begin{proof}
For a point process to be poisson, it should have independent stationary increments.
Let $(t_0,t_1], (t_1,t_2], \dots, (t_{n-1},t_n]$ be the time intervals.
$z_i$ be number of arrivals of class-$c$ during interval $(t_i,t_{i+1}]$.

we want to show
\eq{
\E[f_0(z_0), f_1(z_1), \dots, f_{n-1}(z_{n-1})] = \prod_{i=0}^{n-1} \E[f_i(z_i)]
}
LHS can be written as 
\eq{
LHS &= \E[\E[f_0(z_0), f_1(z_1), \dots, f_{n-1}(z_{n-1})|\F_{t_1}]]\\
&= \E[f_0(z_0) \E[f_1(z_1), \dots, f_{n-1}(z_{n-1})|\F_{t_1}]]
}
Since $X_{t}$ is MC and $\F_{t_1}$ is nothing but knowing $X_{t_1}$
\eq{
&= \E[f_0(z_0) \E[f_1(z_1), \dots, f_{n-1}(z_{n-1})|X_{t_1}]]
}
Sinve $X_t$ is quasi reversible, $z_1, z_2, \dots, z_{n-1}$ are independent of $x_{t_1}$.
\eq{
&=  \E[f_0(z_0)] \E[f_1(z_1), \dots, f_{n-1}(z_{n-1})] \\
&= \prod_{i=0}^{n-1} \E[f_i(z_i)] \quad \quad \text{(conditioning iteratively)}
}
\end{proof}

\section{{\color{red}{Single server queue}}}
%\red{5 processes}

\begin{enumerate}[label=(\arabic*)]
\item $M/M/1/FCFS$ is quasireversible.
\item $M/GI/1/FCFS$ is not quasireversible unless service times are exponential.
\item $M/GI/\infty$ is quasireversible.
\item $M/GI/1/PS$ is quasireversible.
\item $M/GI/1/LCFS$ is quasireversible.
\end{enumerate}

In $(2)-(4)$, $q_t$ is not Markov chain. However, $X_t = (q_t,r_t)$ is a Markov chain, where $r_t$ is residual service time of customers in service, a real number. But, this is not a countable state Matrkov chain. To overcome this, we use phase type distributions. 

\textbf{Phase type distribution:}\\
Let $R_t$ be a finite state MC with chain with state space $\{1,2,3, \dots, m+1\}$ with generator matrix
\begin{align*}
	Q = 
\begin{bmatrix}
	Q_m      & q_o \\
	q_1      & q_2 \\	
\end{bmatrix}
\end{align*}
Define $\tau = \inf\{t: R_t = m+1\}$ correspond to the service time of a customer. Now, $X_t = (q_t,r_t)$ where $r_t \in R_t$ has finite states. We have,
\eq{
P[\tau > t] = \alpha \exp^{Q_m t} 1.
}
Where $\alpha$ is the distribution of $R_0$. Any distribution on $\R^+$ can be arbitrariy closely approximated by phase type distributions. \\
\indent Let $X_t$ in $M/GI/1/LCFS$  be arrivals are coming as a Poisson process, $X_t$ and future arrivals are independent of each other.
$\tilde{X}_t$ the reversed process. $X_t$ and past departures are independent.
\begin{prop}
$\tilde{X}_t$ the reversed process, also represents $M/GI/1$ LCFS system.
\end{prop}

We now consider a multiclass queueing system where $\{X_t\}$ is a quasi-reversible process. Let $C$ be the set of classes. Arrivals of different classes are independent Poisson process and departures of different process are also Poisson processs. $N_c^+ (t)$  be attival process of class-$c$ and $N_c^-(t)$ be departure process of class-$c$, $\mu_c^+$ be arrival rate of class-$c$, $\mu_c^-$ departure rate of class-$c$.

$A^c = \{(i,j) \quad s.t \quad i \to j, \text{it represents an arrival for class-c}\}$,

$D^c = \{(i,j) \quad s.t \quad i \to j, \text{it represents an departure of class-c}\}$

For $M/M/1$ queue with $c$ classes
$X_t = (c_1, c_2, \dots, c_n)$,
the arrival and departures of class-$c$ are denoted by
\eq{
(c_1, c_2, \dots, c_n) \to (c_1, c_2, \dots, c_n, c) \in A^c\\
(c_1, c_2, \dots, c_n) \to (c_2, \dots, c_n, c) \in D^c
}
then, if $X_t = i$ then arrivals of class-$c$ will come at rate = $\sum_{j:(i,j) \in A^c} \lambda_{i,j}$.

Arrival rate of class-$c$ under stationarity ($\pi$ stationary distribution)
\eq{
= \sum_i \pi(i) \sum_{j:(i,j) \in A^c} \lambda_{i,j}
}
But, $\{X_t\}$ is a quasi reversible process, therefore $X_t$ is independent of future arrivals, $\sum_{j:(i,j) \in A^c} \lambda_{i,j}$ does not depend on $i$.
\eq{
&= \sum_{j:(i,j) \in A^c} \lambda_{i,j} \sum_i \pi(i)
}
Therefore arrival rate of class-$c$ to the system = $\sum_{j:(i,j) \in A^c} \lambda_{i,j} = \mu_i^+(i)$.

Consider reversed process $\tilde{X}_t$, this is also quasi reversible. Its stationarity distribution is also $\pi$ with $\tilde{Q}$.
\eq{
\pi(i) \tilde{\lambda}(i,j) = \pi(j) \lambda(j,i)
}
Therefore,
\eq{
\tilde{\lambda}(i,j)  = \frac{\pi(j) \lambda(j,i)}{\pi(j)}.
}
The arrival rate of the class-$c$ customer to $\tilde{x}_t$ is $\sum_{j:(i,j) \in \tilde{A}_c}  \tilde{\lambda}(i,j) = \sum_{j:(i,j) \in \tilde{D}_c} \frac{\pi(j) \lambda(j,i)}{\pi(j)}$.
\end{document}